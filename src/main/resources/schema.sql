CREATE TABLE IF NOT EXISTS "USER_FILMORATE" (
  "USER_ID" INTEGER GENERATED BY DEFAULT AS IDENTITY,
  "USER_EMAIL" varchar(128) NOT NULL,
  "USER_LOGIN" varchar(128) NOT NULL,
  "USER_NAME" varchar(128),
  "USER_BIRTHDAY" date NOT NULL,
  CONSTRAINT "PK_USER_FILMORATE_USER_ID" PRIMARY KEY ("USER_ID"),
  CONSTRAINT "UK_USER_FILMORATE_USER_EMAIL" UNIQUE ("USER_EMAIL"),
  CONSTRAINT "UK_USER_FILMORATE_USER_LOGIN" UNIQUE ("USER_LOGIN")
);

CREATE TABLE IF NOT EXISTS "FRIENDSHIP_REQUESTS" (
  "USER_ID" int,
  "REQUESTER_ID" int,
  CONSTRAINT "PK_USER_ID_REQUESTER_ID" PRIMARY KEY ("USER_ID", "REQUESTER_ID"),
  CONSTRAINT "FK_FRIENDSHIP_REQUESTS_USER_ID" FOREIGN KEY ("USER_ID")
        REFERENCES "USER_FILMORATE" ("USER_ID") ON DELETE CASCADE,
  CONSTRAINT "FK_FRIENDSHIP_REQUESTS_REQUESTER_ID" FOREIGN KEY ("REQUESTER_ID")
        REFERENCES "USER_FILMORATE" ("USER_ID") ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS "USER_FRIENDS" (
  "USER_ID" int REFERENCES "USER_FILMORATE" ("USER_ID") ON DELETE CASCADE,
  "FRIEND_ID" int REFERENCES "USER_FILMORATE" ("USER_ID") ON DELETE CASCADE,
  CONSTRAINT "PK_USER_ID_FRIENDS_ID" PRIMARY KEY ("USER_ID", "FRIEND_ID"),
  CONSTRAINT "FK_USER_FRIENDS_USER_ID" FOREIGN KEY ("USER_ID")
        REFERENCES "USER_FILMORATE" ("USER_ID") ON DELETE CASCADE,
  CONSTRAINT "FK_USER_FRIENDS_REQUESTER_ID" FOREIGN KEY ("FRIEND_ID")
        REFERENCES "USER_FILMORATE" ("USER_ID") ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS "RATING" (
  "RATING_ID" INTEGER GENERATED BY DEFAULT AS IDENTITY,
  "RATING_NAME" varchar(30) NOT NULL,
  CONSTRAINT "PK_RATING_RATING_ID" PRIMARY KEY ("RATING_ID"),
  CONSTRAINT "UK_RATING_RATING_NAME" UNIQUE ("RATING_NAME")
);

CREATE TABLE IF NOT EXISTS "GENRE" (
  "GENRE_ID" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "GENRE_NAME" varchar(30) NOT NULL,
  CONSTRAINT "PK_GENRE_GENRE_ID" PRIMARY KEY ("GENRE_ID"),
  CONSTRAINT "UK_GENRE_GENRE_NAME" UNIQUE ("GENRE_NAME")
);

CREATE TABLE IF NOT EXISTS "FILM" (
  "FILM_ID" INTEGER GENERATED BY DEFAULT AS IDENTITY,
  "FILM_NAME" varchar(128) NOT NULL,
  "FILM_DESCRIPTION" varchar(200) NOT NULL,
  "FILM_RELEASE_DATE" date NOT NULL,
  "FILM_DURATION" int NOT NULL,
  "RATING_ID" int NOT NULL,
  CONSTRAINT "PK_FILM_FILM_ID" PRIMARY KEY ("FILM_ID"),
  CONSTRAINT "FK_FILM_RATING_ID" FOREIGN KEY ("RATING_ID")
        REFERENCES "RATING" ("RATING_ID")
);

CREATE TABLE IF NOT EXISTS "FILM_GENRE" (
  "FILM_ID" int,
  "GENRE_ID" int,
  CONSTRAINT "PK_FILM_ID_GENRE_ID" PRIMARY KEY ("FILM_ID", "GENRE_ID"),
  CONSTRAINT "FK_FILM_GENRE_FILM_ID" FOREIGN KEY ("FILM_ID")
        REFERENCES "FILM" ("FILM_ID") ON DELETE CASCADE,
  CONSTRAINT "FK_FILM_GENRE_GENRE_ID" FOREIGN KEY ("GENRE_ID")
        REFERENCES "GENRE" ("GENRE_ID") ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS "LIKES" (
  "FILM_ID" int,
  "USER_ID" int,
  CONSTRAINT "PK_FILM_ID_USER_ID" PRIMARY KEY ("FILM_ID", "USER_ID"),
  CONSTRAINT "FK_LIKES_FILM_ID" FOREIGN KEY ("FILM_ID")
        REFERENCES "FILM" ("FILM_ID") ON DELETE CASCADE,
  CONSTRAINT "FK_LIKES_USER_ID" FOREIGN KEY ("USER_ID")
        REFERENCES "USER_FILMORATE" ("USER_ID") ON DELETE CASCADE
);

